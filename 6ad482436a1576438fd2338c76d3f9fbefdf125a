{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "d544cb0c_e55edce2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 6642
      },
      "writtenOn": "2021-05-31T18:15:12Z",
      "side": 1,
      "message": "Hi Eric,\n\nI use upsync to backup my upspin data. When I first listed my files after pulling them I thought upsync resets their modtime to the current time. Obviously it doesn\u0027t, but I just happen to have had a bunch of directories in the top level.\n\nThis change matches the local directory timestamps to match the upspin ones, to save folks like me the initial surprise.",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f7db708d_c4ff45da",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5307
      },
      "writtenOn": "2021-05-31T20:53:37Z",
      "side": 1,
      "message": "The existing behavior didn\u0027t seem entirely surprising to me because I frequently see it when untar\u0027ing packages from others. But you\u0027re right it would be nicer to have the local directory times match the central copy.",
      "parentUuid": "d544cb0c_e55edce2",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8661acd8_e5c4bccc",
        "filename": "cmd/upsync/upsync.go",
        "patchSetId": 2
      },
      "lineNbr": 203,
      "author": {
        "id": 5307
      },
      "writtenOn": "2021-05-31T20:53:37Z",
      "side": 1,
      "message": "Is this the only case where we need the chtime? I need to think through all the possibilities of a new directory, adding new file to existing directory, and removing a file.",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e79b08c2_d413d3b4",
        "filename": "cmd/upsync/upsync.go",
        "patchSetId": 2
      },
      "lineNbr": 203,
      "author": {
        "id": 6642
      },
      "writtenOn": "2021-06-02T11:01:26Z",
      "side": 1,
      "message": "you\u0027re absolutely right. this will only work for the initial checkout.\n\na fix should only chtime on a directory if pull() or mkdir() was called on any of its direct children. my reasoning:\n\n1) if a child is newer on upspin:\n  pull()/mkdir() will update local directory modtime to \u0027now\u0027, we should chtime to reset it to correct upspin modtime.\n\n2) if there\u0027s no change: no need to chtime.\n\n3) if a child is newer locally:\n  push() will update time on upspin to \u0027now\u0027. the times will be different, but changing the local time to match upspin is also a little surprising. if i call upsync to only push some files i don\u0027t expect my local filesystem to change. e.g. this might be problematic if upsync has read-only access to a directory.\n\n(1) this takes precedence over (2) or (3).\n\ni guess this is not the trivial 2 line change i initially imagined! i\u0027ll have another go to see if i can do it cleanly.",
      "parentUuid": "8661acd8_e5c4bccc",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9a0c8150_01d9232a",
        "filename": "cmd/upsync/upsync.go",
        "patchSetId": 2
      },
      "lineNbr": 212,
      "author": {
        "id": 5307
      },
      "writtenOn": "2021-05-31T20:53:37Z",
      "side": 1,
      "message": "I\u0027m unfamiliar with the .Go() construction here. Is it the same as time.Unix(udir[uj].Time, 0)?",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "76ff1e4c_3b7ac029",
        "filename": "cmd/upsync/upsync.go",
        "patchSetId": 2
      },
      "lineNbr": 212,
      "author": {
        "id": 6642
      },
      "writtenOn": "2021-06-02T11:01:26Z",
      "side": 1,
      "message": "pretty much :) https://upspin.googlesource.com/upspin/+/033a63d02f07/upspin/code.go#414",
      "parentUuid": "9a0c8150_01d9232a",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d49badb4_0bfeabd7",
        "filename": "cmd/upsync/upsync.go",
        "patchSetId": 2
      },
      "lineNbr": 212,
      "author": {
        "id": 5307
      },
      "writtenOn": "2021-06-02T18:38:02Z",
      "side": 1,
      "message": "Wow, how embarrassing! I\u0027ve clearly forgotten too much and need to page it all back in before trying to do a review.",
      "parentUuid": "76ff1e4c_3b7ac029",
      "revId": "6ad482436a1576438fd2338c76d3f9fbefdf125a",
      "serverId": "0759ed4b-3fdc-34dc-866b-f2e708168c03"
    }
  ]
}